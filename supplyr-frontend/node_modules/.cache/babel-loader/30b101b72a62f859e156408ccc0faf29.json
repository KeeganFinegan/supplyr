{"ast":null,"code":"import _slicedToArray from\"/Users/keeganfinegan/Documents/2021/SoftwareDevelopment/Assignment/supplyr/supplyr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/keeganfinegan/Documents/2021/SoftwareDevelopment/Assignment/supplyr/supplyr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/keeganfinegan/Documents/2021/SoftwareDevelopment/Assignment/supplyr/supplyr-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";var _this=this;import React,{Component,useHistory,useState,useEffect}from'react';import{Orders}from'./Orders';import{UserContext}from'../../context/AppContext';import{AssetInfo}from'./AssetInfo';import'./Overview.css';import Cookie from'js-cookie';import Navbar from'../Navbar/Navbar';import'../Navbar/Navbar.css';import'bootstrap/dist/css/bootstrap.min.css';import'react-toastify/dist/ReactToastify.css';import{toast}from'react-toastify';import{AssetDropdown}from'../UI/AssetDropdown';import{withRouter}from'react-router-dom';import{Container,Row,Col,Table,Spinner,Dropdown,DropdownButton,Button}from'react-bootstrap';import jwt_decode from'jwt-decode';import{Redirect}from'react-router';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";toast.configure();var countOrders=function countOrders(orderList,type){var numOrders=0;orderList.forEach(function(order){if(order.type===type){numOrders++;}});return numOrders;};var renderAsset=function renderAsset(asset,index){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"table-body\",children:asset.asset.name}),/*#__PURE__*/_jsx(\"td\",{className:\"table-body\",children:asset.quantity})]},index);};var renderBlank=function renderBlank(){return/*#__PURE__*/_jsx(\"p\",{children:\"no assets\"});};var submitOrder=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(unit,asset,quantity,price,type){var orderUrl,token,config,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:orderUrl='http://localhost:8080/api/v1/offers/';token=Cookie.get('token');_context.prev=2;config={method:'POST',headers:{Authorization:'Bearer '+token,Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({organisationalUnit:unit,asset:asset,quantity:quantity,price:price})};_context.next=6;return fetch(orderUrl+type.toLowerCase(),config);case 6:response=_context.sent;if(!response.ok){_context.next=12;break;}//return json\ntoast.success(type+' order successfully placed ',{position:toast.POSITION.BOTTOM_RIGHT});return _context.abrupt(\"return\",response.json());case 12:return _context.abrupt(\"return\",response.json().then(function(error){toast.error(error.message,{position:toast.POSITION.BOTTOM_RIGHT});}));case 13:_context.next=17;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](2);case 17:case\"end\":return _context.stop();}}},_callee,null,[[2,15]]);}));return function submitOrder(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments);};}();var fetchUserData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var token,decoded,username,userUrl,userResponse,userData,asset;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:token=Cookie.get('token');decoded=jwt_decode(token);username=decoded.sub;userUrl=\"http://localhost:8080/api/v1/users/\";_context2.next=6;return fetch(userUrl+username,{method:'GET',headers:{Authorization:'Bearer '+token,accept:'application/json','Content-Type':'application/json'}});case 6:userResponse=_context2.sent;_context2.next=9;return userResponse.json();case 9:userData=_context2.sent;_context2.prev=10;typeof userData.organisationalUnit.organisationalUnitAssets!=='undefined'?asset=userData.organisationalUnit.organisationalUnitAssets:asset=null;return _context2.abrupt(\"return\",{userData:userData,asset:asset});case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](10);console.log('ERROR');case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[10,15]]);}));return function fetchUserData(){return _ref2.apply(this,arguments);};}();export var Overview2=function Overview2(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),asset=_useState6[0],setAsset=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),assets=_useState8[0],setAssets=_useState8[1];var _useState9=useState('Select asset'),_useState10=_slicedToArray(_useState9,2),selectedAsset=_useState10[0],setSelectedAsset=_useState10[1];var _useState11=useState('BUY'),_useState12=_slicedToArray(_useState11,2),orderType=_useState12[0],setOrderType=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),orderQuantity=_useState14[0],setOrderQuantity=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),orderPrice=_useState16[0],setOrderPrice=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),orderResponse=_useState18[0],setOrderResponse=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),buyOrdersClicked=_useState20[0],setBuyOrdersClicked=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),sellOrdersClicked=_useState22[0],setSellOrdersClicked=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),assetInfoClicked=_useState24[0],setAssetInfoClicked=_useState24[1];var _useState25=useState(null),_useState26=_slicedToArray(_useState25,2),assetInfo=_useState26[0],setAssetInfo=_useState26[1];var _useState27=useState(null),_useState28=_slicedToArray(_useState27,2),numBuyOrders=_useState28[0],setNumBuyOrders=_useState28[1];var _useState29=useState(null),_useState30=_slicedToArray(_useState29,2),numSellOrders=_useState30[0],setNumSellOrders=_useState30[1];var _useState31=useState(null),_useState32=_slicedToArray(_useState31,2),id=_useState32[0],setId=_useState32[1];useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var dataObject;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetchUserData();case 2:dataObject=_context3.sent;try{setId('123');setLoading(false);setUser(dataObject.userData);setAssets(dataObject.asset);setNumBuyOrders(countOrders(dataObject.userData.organisationalUnit.offers,'BUY'));setNumSellOrders(countOrders(dataObject.userData.organisationalUnit.offers,'SELL'));}catch(error){console.log(error);}case 4:case\"end\":return _context3.stop();}}},_callee3);})),[]);var updateSelectedAsset=function updateSelectedAsset(newAsset){setSelectedAsset(newAsset);};var updateClickedState=function updateClickedState(type){if(type==='BUY'){setBuyOrdersClicked(false);}else if(type==='SELL'){setSellOrdersClicked(false);}else if(type==='ASSET_TRUE'){_this.setState({assetInfoClicked:true});setAssetInfoClicked(true);}else if(type==='ASSET_FALSE'){setAssetInfoClicked(false);}};var handleRefresh=function handleRefresh(){// by calling this method react re-renders the component\nreturn/*#__PURE__*/_jsx(Redirect,{to:{pathname:'/login'}});};if(loading||!user){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",children:/*#__PURE__*/_jsx(Spinner,{animation:\"border\",variant:\"secondary\"})});}else{return/*#__PURE__*/_jsxs(Container,{className:\"overview-container\",children:[/*#__PURE__*/_jsx(Navbar,{}),buyOrdersClicked?/*#__PURE__*/_jsx(Orders,{updateClickedState:updateClickedState,orderList:user.organisationalUnit.offers,type:'BUY',fetchUserData:fetchUserData}):null,sellOrdersClicked?/*#__PURE__*/_jsx(Orders,{updateClickedState:updateClickedState,orderList:user.organisationalUnit.offers,type:'SELL',fetchUserData:fetchUserData}):null,assetInfoClicked?/*#__PURE__*/_jsx(AssetInfo,{asset:selectedAsset,updateClickedState:updateClickedState}):null,/*#__PURE__*/_jsx(Row,{className:\"card-row\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-users card-icon\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-inner\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card-title\",children:\"Organisational Unit\"}),/*#__PURE__*/_jsx(\"p\",{className:\"card-text\",children:user.organisationalUnit.name})]})]})})}),/*#__PURE__*/_jsxs(Row,{className:\"card-row\",children:[' ',/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-coins card-icon\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-inner\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card-title\",children:\"Credits\"}),/*#__PURE__*/_jsx(\"p\",{className:\"card-text\",children:user.organisationalUnit.credits})]})]})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card clickable\",onClick:function onClick(){return setBuyOrdersClicked(true);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-clipboard-list card-icon green\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-inner\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card-title\",children:\"BUY Orders\"}),/*#__PURE__*/_jsx(\"p\",{className:\"card-text\",children:numBuyOrders})]})]})}),/*#__PURE__*/_jsxs(Col,{children:[' ',/*#__PURE__*/_jsxs(\"div\",{className:\"card clickable\",onClick:function onClick(){return setSellOrdersClicked(true);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-clipboard-list card-icon red\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-inner\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card-title\",children:\"SELL Orders\"}),/*#__PURE__*/_jsx(\"p\",{className:\"card-text\",children:numSellOrders})]})]})]})]}),/*#__PURE__*/_jsxs(Row,{className:\"card-row\",children:[' ',/*#__PURE__*/_jsxs(Col,{children:[' ',/*#__PURE__*/_jsxs(\"div\",{className:\"card-tall-table\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-boxes card-icon\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"card-title \",children:\"Assets\"}),/*#__PURE__*/_jsxs(Table,{striped:true,hover:true,children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"table-row table-header\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"table-header\",children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{className:\"table-header\",children:\"Quantity\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:assets?assets.map(renderAsset):renderBlank})]})]})]}),/*#__PURE__*/_jsxs(Col,{children:[' ',/*#__PURE__*/_jsxs(\"div\",{className:\"card-tall-table\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-store card-icon\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"card-title \",children:\"Trade\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"form-trade\",children:[' ',/*#__PURE__*/_jsx(AssetDropdown,{selectedAsset:selectedAsset,setAsset:updateSelectedAsset}),selectedAsset!='Select asset'?/*#__PURE__*/_jsx(Button,{className:\"more-info\",onClick:function onClick(){setAssetInfoClicked(true);},children:\"More Info\"}):null]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"quantity-input\",placeholder:\"Quantity\",onChange:function onChange(e){return setOrderQuantity(e.target.value);}}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"quantity-input\",placeholder:\"Price\",onChange:function onChange(e){return setOrderPrice(e.target.value);}}),/*#__PURE__*/_jsxs(DropdownButton,{title:orderType,variant:\"secondary\",children:[/*#__PURE__*/_jsx(Dropdown.Item,{onClick:function onClick(){return setOrderType('BUY');},children:\"BUY\"}),/*#__PURE__*/_jsx(Dropdown.Item,{onClick:function onClick(){return setOrderType('SELL');},children:\"SELL\"})]}),orderPrice>0&&orderQuantity>0&&selectedAsset!=='Select asset'?/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"secondary\",className:\"submit-button\",onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setLoading(true);_context4.next=3;return submitOrder(user.organisationalUnit.name,selectedAsset,orderQuantity,orderPrice,orderType).then(function(){fetchUserData().then(function(newData){handleRefresh();setLoading(false);setOrderQuantity(null);setOrderPrice(null);setUser(newData.userData);setId(Math.random().toString());setNumBuyOrders(countOrders(newData.userData.organisationalUnit.offers,'BUY'));setNumSellOrders(countOrders(newData.userData.organisationalUnit.offers,'SELL'));return newData;});});case 3:case\"end\":return _context4.stop();}}},_callee4);})),children:\"Submit\"}):/*#__PURE__*/_jsx(Button,{className:\"submit-button\",disabled:true,variant:\"secondary\",children:\"Submit\"})]})]})]})]});}};","map":{"version":3,"sources":["/Users/keeganfinegan/Documents/2021/SoftwareDevelopment/Assignment/supplyr/supplyr-frontend/src/components/Overview/Overview2.js"],"names":["React","Component","useHistory","useState","useEffect","Orders","UserContext","AssetInfo","Cookie","Navbar","toast","AssetDropdown","withRouter","Container","Row","Col","Table","Spinner","Dropdown","DropdownButton","Button","jwt_decode","Redirect","configure","countOrders","orderList","type","numOrders","forEach","order","renderAsset","asset","index","name","quantity","renderBlank","submitOrder","unit","price","orderUrl","token","get","config","method","headers","Authorization","Accept","body","JSON","stringify","organisationalUnit","fetch","toLowerCase","response","ok","success","position","POSITION","BOTTOM_RIGHT","json","then","error","message","fetchUserData","decoded","username","sub","userUrl","accept","userResponse","userData","organisationalUnitAssets","console","log","Overview2","loading","setLoading","user","setUser","setAsset","assets","setAssets","selectedAsset","setSelectedAsset","orderType","setOrderType","orderQuantity","setOrderQuantity","orderPrice","setOrderPrice","orderResponse","setOrderResponse","buyOrdersClicked","setBuyOrdersClicked","sellOrdersClicked","setSellOrdersClicked","assetInfoClicked","setAssetInfoClicked","assetInfo","setAssetInfo","numBuyOrders","setNumBuyOrders","numSellOrders","setNumSellOrders","id","setId","dataObject","offers","updateSelectedAsset","newAsset","updateClickedState","setState","handleRefresh","pathname","credits","map","e","target","value","newData","Math","random","toString"],"mappings":"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","sourcesContent":["import React, { Component, useHistory, useState, useEffect } from 'react';\nimport { Orders } from './Orders';\nimport { UserContext } from '../../context/AppContext';\nimport { AssetInfo } from './AssetInfo';\nimport './Overview.css';\nimport Cookie from 'js-cookie';\nimport Navbar from '../Navbar/Navbar';\nimport '../Navbar/Navbar.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { toast } from 'react-toastify';\nimport { AssetDropdown } from '../UI/AssetDropdown';\nimport { withRouter } from 'react-router-dom';\n\nimport {\n  Container,\n  Row,\n  Col,\n  Table,\n  Spinner,\n  Dropdown,\n  DropdownButton,\n  Button,\n} from 'react-bootstrap';\nimport jwt_decode from 'jwt-decode';\nimport { Redirect } from 'react-router';\n\ntoast.configure();\n\nconst countOrders = (orderList, type) => {\n  let numOrders = 0;\n\n  orderList.forEach((order) => {\n    if (order.type === type) {\n      numOrders++;\n    }\n  });\n  return numOrders;\n};\n\nconst renderAsset = (asset, index) => {\n  return (\n    <tr key={index}>\n      <td className=\"table-body\">{asset.asset.name}</td>\n      <td className=\"table-body\">{asset.quantity}</td>\n    </tr>\n  );\n};\n\nconst renderBlank = () => {\n  return <p>no assets</p>;\n};\n\nconst submitOrder = async (unit, asset, quantity, price, type) => {\n  const orderUrl = 'http://localhost:8080/api/v1/offers/';\n  let token = Cookie.get('token');\n\n  try {\n    const config = {\n      method: 'POST',\n      headers: {\n        Authorization: 'Bearer ' + token,\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        organisationalUnit: unit,\n        asset: asset,\n        quantity: quantity,\n        price: price,\n      }),\n    };\n    const response = await fetch(orderUrl + type.toLowerCase(), config);\n\n    if (response.ok) {\n      //return json\n      toast.success(type + ' order successfully placed ', {\n        position: toast.POSITION.BOTTOM_RIGHT,\n      });\n      return response.json();\n    } else {\n      //\n      return response.json().then((error) => {\n        toast.error(error.message, {\n          position: toast.POSITION.BOTTOM_RIGHT,\n        });\n      });\n    }\n  } catch (error) {}\n};\n\nconst fetchUserData = async () => {\n  let token = Cookie.get('token');\n  let decoded = jwt_decode(token);\n  let username = decoded.sub;\n\n  const userUrl = `http://localhost:8080/api/v1/users/`;\n  const userResponse = await fetch(userUrl + username, {\n    method: 'GET',\n    headers: {\n      Authorization: 'Bearer ' + token,\n      accept: 'application/json',\n      'Content-Type': 'application/json',\n    },\n  });\n  const userData = await userResponse.json();\n\n  let asset;\n\n  try {\n    typeof userData.organisationalUnit.organisationalUnitAssets !== 'undefined'\n      ? (asset = userData.organisationalUnit.organisationalUnitAssets)\n      : (asset = null);\n\n    return {\n      userData: userData,\n      asset: asset,\n    };\n  } catch (error) {\n    console.log('ERROR');\n  }\n};\n\nexport const Overview2 = () => {\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState(null);\n  const [asset, setAsset] = useState(null);\n  const [assets, setAssets] = useState(null);\n  const [selectedAsset, setSelectedAsset] = useState('Select asset');\n  const [orderType, setOrderType] = useState('BUY');\n  const [orderQuantity, setOrderQuantity] = useState(null);\n  const [orderPrice, setOrderPrice] = useState(null);\n  const [orderResponse, setOrderResponse] = useState(null);\n  const [buyOrdersClicked, setBuyOrdersClicked] = useState(false);\n  const [sellOrdersClicked, setSellOrdersClicked] = useState(false);\n  const [assetInfoClicked, setAssetInfoClicked] = useState(false);\n  const [assetInfo, setAssetInfo] = useState(null);\n  const [numBuyOrders, setNumBuyOrders] = useState(null);\n  const [numSellOrders, setNumSellOrders] = useState(null);\n  const [id, setId] = useState(null);\n\n  useEffect(async () => {\n    const dataObject = await fetchUserData();\n\n    try {\n      setId('123');\n      setLoading(false);\n      setUser(dataObject.userData);\n      setAssets(dataObject.asset);\n      setNumBuyOrders(\n        countOrders(dataObject.userData.organisationalUnit.offers, 'BUY')\n      );\n      setNumSellOrders(\n        countOrders(dataObject.userData.organisationalUnit.offers, 'SELL')\n      );\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n\n  const updateSelectedAsset = (newAsset) => {\n    setSelectedAsset(newAsset);\n  };\n\n  const updateClickedState = (type) => {\n    if (type === 'BUY') {\n      setBuyOrdersClicked(false);\n    } else if (type === 'SELL') {\n      setSellOrdersClicked(false);\n    } else if (type === 'ASSET_TRUE') {\n      this.setState({ assetInfoClicked: true });\n      setAssetInfoClicked(true);\n    } else if (type === 'ASSET_FALSE') {\n      setAssetInfoClicked(false);\n    }\n  };\n\n  const handleRefresh = () => {\n    // by calling this method react re-renders the component\n    return (\n      <Redirect\n        to={{\n          pathname: '/login',\n        }}\n      ></Redirect>\n    );\n  };\n\n  if (loading || !user) {\n    return (\n      <div className=\"loading-container\">\n        <Spinner animation=\"border\" variant=\"secondary\" />\n      </div>\n    );\n  } else {\n    return (\n      <Container className=\"overview-container\">\n        <Navbar />\n        {buyOrdersClicked ? (\n          <Orders\n            updateClickedState={updateClickedState}\n            orderList={user.organisationalUnit.offers}\n            type={'BUY'}\n            fetchUserData={fetchUserData}\n          />\n        ) : null}\n        {sellOrdersClicked ? (\n          <Orders\n            updateClickedState={updateClickedState}\n            orderList={user.organisationalUnit.offers}\n            type={'SELL'}\n            fetchUserData={fetchUserData}\n          />\n        ) : null}\n        {assetInfoClicked ? (\n          <AssetInfo\n            asset={selectedAsset}\n            updateClickedState={updateClickedState}\n          />\n        ) : null}\n        <Row className=\"card-row\">\n          <Col>\n            <div className=\"card\">\n              <i className=\"fas fa-users card-icon\"></i>\n              <div className=\"card-inner\">\n                <h2 className=\"card-title\">Organisational Unit</h2>\n                <p className=\"card-text\">{user.organisationalUnit.name}</p>\n              </div>\n            </div>\n          </Col>\n        </Row>\n        <Row className=\"card-row\">\n          {' '}\n          <Col>\n            <div className=\"card\">\n              <i className=\"fas fa-coins card-icon\"></i>\n              <div className=\"card-inner\">\n                <h2 className=\"card-title\">Credits</h2>\n                <p className=\"card-text\">{user.organisationalUnit.credits}</p>\n              </div>\n            </div>\n          </Col>\n          <Col>\n            <div\n              className=\"card clickable\"\n              onClick={() => setBuyOrdersClicked(true)}\n            >\n              <i className=\"fas fa-clipboard-list card-icon green\"></i>\n              <div className=\"card-inner\">\n                <h2 className=\"card-title\">BUY Orders</h2>\n                <p className=\"card-text\">{numBuyOrders}</p>\n              </div>\n            </div>\n          </Col>\n          <Col>\n            {' '}\n            <div\n              className=\"card clickable\"\n              onClick={() => setSellOrdersClicked(true)}\n            >\n              <i className=\"fas fa-clipboard-list card-icon red\"></i>\n              <div className=\"card-inner\">\n                <h2 className=\"card-title\">SELL Orders</h2>\n                <p className=\"card-text\">{numSellOrders}</p>\n              </div>\n            </div>\n          </Col>\n        </Row>\n        <Row className=\"card-row\">\n          {' '}\n          <Col>\n            {' '}\n            <div className=\"card-tall-table\">\n              <i className=\"fas fa-boxes card-icon\"></i>\n              <h3 className=\"card-title \">Assets</h3>\n              <Table striped hover>\n                <thead>\n                  <tr className=\"table-row table-header\">\n                    <th className=\"table-header\">Name</th>\n                    <th className=\"table-header\">Quantity</th>\n                  </tr>\n                </thead>\n                <tbody>{assets ? assets.map(renderAsset) : renderBlank}</tbody>\n              </Table>\n            </div>\n          </Col>\n          <Col>\n            {' '}\n            <div className=\"card-tall-table\">\n              <i className=\"fas fa-store card-icon\"></i>\n              <h3 className=\"card-title \">Trade</h3>\n              <form className=\"form-trade\">\n                {' '}\n                <AssetDropdown\n                  selectedAsset={selectedAsset}\n                  setAsset={updateSelectedAsset}\n                />\n                {selectedAsset != 'Select asset' ? (\n                  <Button\n                    className=\"more-info\"\n                    onClick={() => {\n                      setAssetInfoClicked(true);\n                    }}\n                  >\n                    More Info\n                  </Button>\n                ) : null}\n              </form>\n              <input\n                type=\"number\"\n                className=\"quantity-input\"\n                placeholder=\"Quantity\"\n                onChange={(e) => setOrderQuantity(e.target.value)}\n              ></input>\n              <input\n                type=\"number\"\n                className=\"quantity-input\"\n                placeholder=\"Price\"\n                onChange={(e) => setOrderPrice(e.target.value)}\n              ></input>\n              <DropdownButton title={orderType} variant=\"secondary\">\n                <Dropdown.Item onClick={() => setOrderType('BUY')}>\n                  BUY\n                </Dropdown.Item>\n                <Dropdown.Item onClick={() => setOrderType('SELL')}>\n                  SELL\n                </Dropdown.Item>\n              </DropdownButton>\n              {orderPrice > 0 &&\n              orderQuantity > 0 &&\n              selectedAsset !== 'Select asset' ? (\n                <Button\n                  type=\"button\"\n                  variant=\"secondary\"\n                  className=\"submit-button\"\n                  onClick={async () => {\n                    setLoading(true);\n                    await submitOrder(\n                      user.organisationalUnit.name,\n                      selectedAsset,\n                      orderQuantity,\n                      orderPrice,\n                      orderType\n                    ).then(() => {\n                      fetchUserData().then((newData) => {\n                        handleRefresh();\n\n                        setLoading(false);\n                        setOrderQuantity(null);\n                        setOrderPrice(null);\n                        setUser(newData.userData);\n                        setId(Math.random().toString());\n                        setNumBuyOrders(\n                          countOrders(\n                            newData.userData.organisationalUnit.offers,\n                            'BUY'\n                          )\n                        );\n                        setNumSellOrders(\n                          countOrders(\n                            newData.userData.organisationalUnit.offers,\n                            'SELL'\n                          )\n                        );\n                        return newData;\n                      });\n                    });\n                  }}\n                >\n                  Submit\n                </Button>\n              ) : (\n                <Button className=\"submit-button\" disabled variant=\"secondary\">\n                  Submit\n                </Button>\n              )}\n            </div>\n          </Col>\n        </Row>\n      </Container>\n    );\n  }\n};\n"]},"metadata":{},"sourceType":"module"}