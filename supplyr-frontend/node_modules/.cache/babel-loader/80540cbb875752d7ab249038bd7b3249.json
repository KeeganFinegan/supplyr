{"ast":null,"code":"var _jsxFileName = \"/Users/keeganfinegan/Documents/2021/SoftwareDevelopment/Assignment/supplyr/supplyr-frontend/src/components/Overview/Overview2.js\",\n    _s = $RefreshSig$();\n\nimport React, { Component, useHistory, useState, useEffect } from 'react';\nimport { Orders } from './Orders';\nimport { UserContext } from '../../context/AppContext';\nimport { AssetInfo } from './AssetInfo';\nimport './Overview.css';\nimport Cookie from 'js-cookie';\nimport Navbar from '../Navbar/Navbar';\nimport '../Navbar/Navbar.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { toast } from 'react-toastify';\nimport { AssetDropdown } from '../UI/AssetDropdown';\nimport { withRouter } from 'react-router-dom';\nimport { Container, Row, Col, Table, Spinner, Dropdown, DropdownButton, Button } from 'react-bootstrap';\nimport jwt_decode from 'jwt-decode';\nimport { Redirect } from 'react-router';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ntoast.configure();\n\nconst countOrders = (orderList, type) => {\n  let numOrders = 0;\n  orderList.forEach(order => {\n    if (order.type === type) {\n      numOrders++;\n    }\n  });\n  return numOrders;\n};\n\nconst renderAsset = (asset, index) => {\n  return /*#__PURE__*/_jsxDEV(\"tr\", {\n    children: [/*#__PURE__*/_jsxDEV(\"td\", {\n      className: \"table-body\",\n      children: asset.asset.name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n      className: \"table-body\",\n      children: asset.quantity\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 7\n    }, this)]\n  }, index, true, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 5\n  }, this);\n};\n\nconst renderBlank = () => {\n  return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"no assets\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 51,\n    columnNumber: 10\n  }, this);\n};\n\nconst submitOrder = async (unit, asset, quantity, price, type) => {\n  const orderUrl = 'http://localhost:8080/api/v1/offers/';\n  let token = Cookie.get('token');\n\n  try {\n    const config = {\n      method: 'POST',\n      headers: {\n        Authorization: 'Bearer ' + token,\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        organisationalUnit: unit,\n        asset: asset,\n        quantity: quantity,\n        price: price\n      })\n    };\n    const response = await fetch(orderUrl + type.toLowerCase(), config);\n\n    if (response.ok) {\n      //return json\n      toast.success(type + ' order successfully placed ', {\n        position: toast.POSITION.BOTTOM_RIGHT\n      });\n      return response.json();\n    } else {\n      //\n      return response.json().then(error => {\n        toast.error(error.message, {\n          position: toast.POSITION.BOTTOM_RIGHT\n        });\n      });\n    }\n  } catch (error) {}\n};\n\nconst fetchUserData = async () => {\n  let token = Cookie.get('token');\n  let decoded = jwt_decode(token);\n  let username = decoded.sub;\n  const userUrl = `http://localhost:8080/api/v1/users/`;\n  const userResponse = await fetch(userUrl + username, {\n    method: 'GET',\n    headers: {\n      Authorization: 'Bearer ' + token,\n      accept: 'application/json',\n      'Content-Type': 'application/json'\n    }\n  });\n  const userData = await userResponse.json();\n  let asset;\n\n  try {\n    typeof userData.organisationalUnit.organisationalUnitAssets !== 'undefined' ? asset = userData.organisationalUnit.organisationalUnitAssets : asset = null;\n    return {\n      userData: userData,\n      asset: asset\n    };\n  } catch (error) {\n    history.push('/login');\n  }\n};\n\nexport const Overview2 = () => {\n  _s();\n\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState(null);\n  const [asset, setAsset] = useState(null);\n  const [assets, setAssets] = useState(null);\n  const [selectedAsset, setSelectedAsset] = useState('Select asset');\n  const [orderType, setOrderType] = useState('BUY');\n  const [orderQuantity, setOrderQuantity] = useState(null);\n  const [orderPrice, setOrderPrice] = useState(null);\n  const [orderResponse, setOrderResponse] = useState(null);\n  const [buyOrdersClicked, setBuyOrdersClicked] = useState(false);\n  const [sellOrdersClicked, setSellOrdersClicked] = useState(false);\n  const [assetInfoClicked, setAssetInfoClicked] = useState(false);\n  const [assetInfo, setAssetInfo] = useState(null);\n  const [numBuyOrders, setNumBuyOrders] = useState(null);\n  const [numSellOrders, setNumSellOrders] = useState(null);\n  const [id, setId] = useState(null);\n  let history = useHistory();\n  useEffect(() => {\n    const dataObject = fetchUserData();\n\n    try {\n      setId('123');\n      setLoading(false);\n      setUser(dataObject.userData);\n      setAssets(dataObject.asset);\n      setNumBuyOrders(countOrders(dataObject.userData.organisationalUnit.offers, 'BUY'));\n      setNumSellOrders(countOrders(dataObject.userData.organisationalUnit.offers, 'SELL'));\n    } catch (error) {\n      history.push('/login');\n    }\n  }, []);\n\n  const updateSelectedAsset = newAsset => {\n    setSelectedAsset(newAsset);\n  };\n\n  const updateClickedState = type => {\n    if (type === 'BUY') {\n      setBuyOrdersClicked(false);\n    } else if (type === 'SELL') {\n      setSellOrdersClicked(false);\n    } else if (type === 'ASSET_TRUE') {\n      this.setState({\n        assetInfoClicked: true\n      });\n      setAssetInfoClicked(true);\n    } else if (type === 'ASSET_FALSE') {\n      setAssetInfoClicked(false);\n    }\n  };\n\n  const handleRefresh = () => {\n    // by calling this method react re-renders the component\n    return /*#__PURE__*/_jsxDEV(Redirect, {\n      to: {\n        pathname: '/login'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }, this);\n  };\n\n  if (loading || !user) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      children: /*#__PURE__*/_jsxDEV(Spinner, {\n        animation: \"border\",\n        variant: \"secondary\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 7\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      className: \"overview-container\",\n      children: [/*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 9\n      }, this), buyOrdersClicked ? /*#__PURE__*/_jsxDEV(Orders, {\n        updateClickedState: updateClickedState,\n        orderList: user.organisationalUnit.offers,\n        type: 'BUY',\n        fetchUserData: fetchUserData\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 11\n      }, this) : null, sellOrdersClicked ? /*#__PURE__*/_jsxDEV(Orders, {\n        updateClickedState: updateClickedState,\n        orderList: user.organisationalUnit.offers,\n        type: 'SELL',\n        fetchUserData: fetchUserData\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 11\n      }, this) : null, assetInfoClicked ? /*#__PURE__*/_jsxDEV(AssetInfo, {\n        asset: selectedAsset,\n        updateClickedState: updateClickedState\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 11\n      }, this) : null, /*#__PURE__*/_jsxDEV(Row, {\n        className: \"card-row\",\n        children: /*#__PURE__*/_jsxDEV(Col, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card\",\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fas fa-users card-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 226,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card-inner\",\n              children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                className: \"card-title\",\n                children: \"Organisational Unit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 228,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"card-text\",\n                children: user.organisationalUnit.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 229,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 227,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Row, {\n        className: \"card-row\",\n        children: [' ', /*#__PURE__*/_jsxDEV(Col, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card\",\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fas fa-coins card-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 238,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card-inner\",\n              children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                className: \"card-title\",\n                children: \"Credits\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 240,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"card-text\",\n                children: user.organisationalUnit.credits\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card clickable\",\n            onClick: () => setBuyOrdersClicked(true),\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fas fa-clipboard-list card-icon green\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card-inner\",\n              children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                className: \"card-title\",\n                children: \"BUY Orders\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 252,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"card-text\",\n                children: numBuyOrders\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          children: [' ', /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card clickable\",\n            onClick: () => setSellOrdersClicked(true),\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fas fa-clipboard-list card-icon red\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card-inner\",\n              children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                className: \"card-title\",\n                children: \"SELL Orders\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 265,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"card-text\",\n                children: numSellOrders\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Row, {\n        className: \"card-row\",\n        children: [' ', /*#__PURE__*/_jsxDEV(Col, {\n          children: [' ', /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-tall-table\",\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fas fa-boxes card-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"card-title \",\n              children: \"Assets\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 277,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Table, {\n              striped: true,\n              hover: true,\n              children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n                children: /*#__PURE__*/_jsxDEV(\"tr\", {\n                  className: \"table-row table-header\",\n                  children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                    className: \"table-header\",\n                    children: \"Name\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 281,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    className: \"table-header\",\n                    children: \"Quantity\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 282,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 280,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n                children: assets ? assets.map(renderAsset) : renderBlank\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 285,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 278,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          children: [' ', /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-tall-table\",\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fas fa-store card-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"card-title \",\n              children: \"Trade\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n              className: \"form-trade\",\n              children: [' ', /*#__PURE__*/_jsxDEV(AssetDropdown, {\n                selectedAsset: selectedAsset,\n                setAsset: updateSelectedAsset\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 296,\n                columnNumber: 17\n              }, this), selectedAsset != 'Select asset' ? /*#__PURE__*/_jsxDEV(Button, {\n                className: \"more-info\",\n                onClick: () => {\n                  setAssetInfoClicked(true);\n                },\n                children: \"More Info\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 301,\n                columnNumber: 19\n              }, this) : null]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              className: \"quantity-input\",\n              placeholder: \"Quantity\",\n              onChange: e => setOrderQuantity(e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              className: \"quantity-input\",\n              placeholder: \"Price\",\n              onChange: e => setOrderPrice(e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 317,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(DropdownButton, {\n              title: orderType,\n              variant: \"secondary\",\n              children: [/*#__PURE__*/_jsxDEV(Dropdown.Item, {\n                onClick: () => setOrderType('BUY'),\n                children: \"BUY\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 324,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Dropdown.Item, {\n                onClick: () => setOrderType('SELL'),\n                children: \"SELL\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 327,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 323,\n              columnNumber: 15\n            }, this), orderPrice > 0 && orderQuantity > 0 && selectedAsset !== 'Select asset' ? /*#__PURE__*/_jsxDEV(Button, {\n              type: \"button\",\n              variant: \"secondary\",\n              className: \"submit-button\",\n              onClick: async () => {\n                setLoading(true);\n                await submitOrder(user.organisationalUnit.name, selectedAsset, orderQuantity, orderPrice, orderType).then(() => {\n                  fetchUserData().then(newData => {\n                    handleRefresh();\n                    setLoading(false);\n                    setOrderQuantity(null);\n                    setOrderPrice(null);\n                    setUser(newData.userData);\n                    setId(Math.random().toString());\n                    setNumBuyOrders(countOrders(newData.userData.organisationalUnit.offers, 'BUY'));\n                    setNumSellOrders(countOrders(newData.userData.organisationalUnit.offers, 'SELL'));\n                    return newData;\n                  });\n                });\n              },\n              children: \"Submit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 334,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Button, {\n              className: \"submit-button\",\n              disabled: true,\n              variant: \"secondary\",\n              children: \"Submit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 375,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 7\n    }, this);\n  }\n};\n\n_s(Overview2, \"vfcFh+Ty6lTQI/mz870CjNtOVLA=\", false, function () {\n  return [useHistory];\n});\n\n_c = Overview2;\n\nvar _c;\n\n$RefreshReg$(_c, \"Overview2\");","map":{"version":3,"sources":["/Users/keeganfinegan/Documents/2021/SoftwareDevelopment/Assignment/supplyr/supplyr-frontend/src/components/Overview/Overview2.js"],"names":["React","Component","useHistory","useState","useEffect","Orders","UserContext","AssetInfo","Cookie","Navbar","toast","AssetDropdown","withRouter","Container","Row","Col","Table","Spinner","Dropdown","DropdownButton","Button","jwt_decode","Redirect","configure","countOrders","orderList","type","numOrders","forEach","order","renderAsset","asset","index","name","quantity","renderBlank","submitOrder","unit","price","orderUrl","token","get","config","method","headers","Authorization","Accept","body","JSON","stringify","organisationalUnit","response","fetch","toLowerCase","ok","success","position","POSITION","BOTTOM_RIGHT","json","then","error","message","fetchUserData","decoded","username","sub","userUrl","userResponse","accept","userData","organisationalUnitAssets","history","push","Overview2","loading","setLoading","user","setUser","setAsset","assets","setAssets","selectedAsset","setSelectedAsset","orderType","setOrderType","orderQuantity","setOrderQuantity","orderPrice","setOrderPrice","orderResponse","setOrderResponse","buyOrdersClicked","setBuyOrdersClicked","sellOrdersClicked","setSellOrdersClicked","assetInfoClicked","setAssetInfoClicked","assetInfo","setAssetInfo","numBuyOrders","setNumBuyOrders","numSellOrders","setNumSellOrders","id","setId","dataObject","offers","updateSelectedAsset","newAsset","updateClickedState","setState","handleRefresh","pathname","credits","map","e","target","value","newData","Math","random","toString"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,UAA3B,EAAuCC,QAAvC,EAAiDC,SAAjD,QAAkE,OAAlE;AACA,SAASC,MAAT,QAAuB,UAAvB;AACA,SAASC,WAAT,QAA4B,0BAA5B;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,OAAO,gBAAP;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,MAAP,MAAmB,kBAAnB;AACA,OAAO,sBAAP;AACA,OAAO,sCAAP;AACA,OAAO,uCAAP;AACA,SAASC,KAAT,QAAsB,gBAAtB;AACA,SAASC,aAAT,QAA8B,qBAA9B;AACA,SAASC,UAAT,QAA2B,kBAA3B;AAEA,SACEC,SADF,EAEEC,GAFF,EAGEC,GAHF,EAIEC,KAJF,EAKEC,OALF,EAMEC,QANF,EAOEC,cAPF,EAQEC,MARF,QASO,iBATP;AAUA,OAAOC,UAAP,MAAuB,YAAvB;AACA,SAASC,QAAT,QAAyB,cAAzB;;AAEAZ,KAAK,CAACa,SAAN;;AAEA,MAAMC,WAAW,GAAG,CAACC,SAAD,EAAYC,IAAZ,KAAqB;AACvC,MAAIC,SAAS,GAAG,CAAhB;AAEAF,EAAAA,SAAS,CAACG,OAAV,CAAmBC,KAAD,IAAW;AAC3B,QAAIA,KAAK,CAACH,IAAN,KAAeA,IAAnB,EAAyB;AACvBC,MAAAA,SAAS;AACV;AACF,GAJD;AAKA,SAAOA,SAAP;AACD,CATD;;AAWA,MAAMG,WAAW,GAAG,CAACC,KAAD,EAAQC,KAAR,KAAkB;AACpC,sBACE;AAAA,4BACE;AAAI,MAAA,SAAS,EAAC,YAAd;AAAA,gBAA4BD,KAAK,CAACA,KAAN,CAAYE;AAAxC;AAAA;AAAA;AAAA;AAAA,YADF,eAEE;AAAI,MAAA,SAAS,EAAC,YAAd;AAAA,gBAA4BF,KAAK,CAACG;AAAlC;AAAA;AAAA;AAAA;AAAA,YAFF;AAAA,KAASF,KAAT;AAAA;AAAA;AAAA;AAAA,UADF;AAMD,CAPD;;AASA,MAAMG,WAAW,GAAG,MAAM;AACxB,sBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACD,CAFD;;AAIA,MAAMC,WAAW,GAAG,OAAOC,IAAP,EAAaN,KAAb,EAAoBG,QAApB,EAA8BI,KAA9B,EAAqCZ,IAArC,KAA8C;AAChE,QAAMa,QAAQ,GAAG,sCAAjB;AACA,MAAIC,KAAK,GAAGhC,MAAM,CAACiC,GAAP,CAAW,OAAX,CAAZ;;AAEA,MAAI;AACF,UAAMC,MAAM,GAAG;AACbC,MAAAA,MAAM,EAAE,MADK;AAEbC,MAAAA,OAAO,EAAE;AACPC,QAAAA,aAAa,EAAE,YAAYL,KADpB;AAEPM,QAAAA,MAAM,EAAE,kBAFD;AAGP,wBAAgB;AAHT,OAFI;AAObC,MAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBC,QAAAA,kBAAkB,EAAEb,IADD;AAEnBN,QAAAA,KAAK,EAAEA,KAFY;AAGnBG,QAAAA,QAAQ,EAAEA,QAHS;AAInBI,QAAAA,KAAK,EAAEA;AAJY,OAAf;AAPO,KAAf;AAcA,UAAMa,QAAQ,GAAG,MAAMC,KAAK,CAACb,QAAQ,GAAGb,IAAI,CAAC2B,WAAL,EAAZ,EAAgCX,MAAhC,CAA5B;;AAEA,QAAIS,QAAQ,CAACG,EAAb,EAAiB;AACf;AACA5C,MAAAA,KAAK,CAAC6C,OAAN,CAAc7B,IAAI,GAAG,6BAArB,EAAoD;AAClD8B,QAAAA,QAAQ,EAAE9C,KAAK,CAAC+C,QAAN,CAAeC;AADyB,OAApD;AAGA,aAAOP,QAAQ,CAACQ,IAAT,EAAP;AACD,KAND,MAMO;AACL;AACA,aAAOR,QAAQ,CAACQ,IAAT,GAAgBC,IAAhB,CAAsBC,KAAD,IAAW;AACrCnD,QAAAA,KAAK,CAACmD,KAAN,CAAYA,KAAK,CAACC,OAAlB,EAA2B;AACzBN,UAAAA,QAAQ,EAAE9C,KAAK,CAAC+C,QAAN,CAAeC;AADA,SAA3B;AAGD,OAJM,CAAP;AAKD;AACF,GA/BD,CA+BE,OAAOG,KAAP,EAAc,CAAE;AACnB,CApCD;;AAsCA,MAAME,aAAa,GAAG,YAAY;AAChC,MAAIvB,KAAK,GAAGhC,MAAM,CAACiC,GAAP,CAAW,OAAX,CAAZ;AACA,MAAIuB,OAAO,GAAG3C,UAAU,CAACmB,KAAD,CAAxB;AACA,MAAIyB,QAAQ,GAAGD,OAAO,CAACE,GAAvB;AAEA,QAAMC,OAAO,GAAI,qCAAjB;AACA,QAAMC,YAAY,GAAG,MAAMhB,KAAK,CAACe,OAAO,GAAGF,QAAX,EAAqB;AACnDtB,IAAAA,MAAM,EAAE,KAD2C;AAEnDC,IAAAA,OAAO,EAAE;AACPC,MAAAA,aAAa,EAAE,YAAYL,KADpB;AAEP6B,MAAAA,MAAM,EAAE,kBAFD;AAGP,sBAAgB;AAHT;AAF0C,GAArB,CAAhC;AAQA,QAAMC,QAAQ,GAAG,MAAMF,YAAY,CAACT,IAAb,EAAvB;AAEA,MAAI5B,KAAJ;;AAEA,MAAI;AACF,WAAOuC,QAAQ,CAACpB,kBAAT,CAA4BqB,wBAAnC,KAAgE,WAAhE,GACKxC,KAAK,GAAGuC,QAAQ,CAACpB,kBAAT,CAA4BqB,wBADzC,GAEKxC,KAAK,GAAG,IAFb;AAIA,WAAO;AACLuC,MAAAA,QAAQ,EAAEA,QADL;AAELvC,MAAAA,KAAK,EAAEA;AAFF,KAAP;AAID,GATD,CASE,OAAO8B,KAAP,EAAc;AACdW,IAAAA,OAAO,CAACC,IAAR,CAAa,QAAb;AACD;AACF,CA9BD;;AAgCA,OAAO,MAAMC,SAAS,GAAG,MAAM;AAAA;;AAC7B,QAAM,CAACC,OAAD,EAAUC,UAAV,IAAwBzE,QAAQ,CAAC,IAAD,CAAtC;AACA,QAAM,CAAC0E,IAAD,EAAOC,OAAP,IAAkB3E,QAAQ,CAAC,IAAD,CAAhC;AACA,QAAM,CAAC4B,KAAD,EAAQgD,QAAR,IAAoB5E,QAAQ,CAAC,IAAD,CAAlC;AACA,QAAM,CAAC6E,MAAD,EAASC,SAAT,IAAsB9E,QAAQ,CAAC,IAAD,CAApC;AACA,QAAM,CAAC+E,aAAD,EAAgBC,gBAAhB,IAAoChF,QAAQ,CAAC,cAAD,CAAlD;AACA,QAAM,CAACiF,SAAD,EAAYC,YAAZ,IAA4BlF,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM,CAACmF,aAAD,EAAgBC,gBAAhB,IAAoCpF,QAAQ,CAAC,IAAD,CAAlD;AACA,QAAM,CAACqF,UAAD,EAAaC,aAAb,IAA8BtF,QAAQ,CAAC,IAAD,CAA5C;AACA,QAAM,CAACuF,aAAD,EAAgBC,gBAAhB,IAAoCxF,QAAQ,CAAC,IAAD,CAAlD;AACA,QAAM,CAACyF,gBAAD,EAAmBC,mBAAnB,IAA0C1F,QAAQ,CAAC,KAAD,CAAxD;AACA,QAAM,CAAC2F,iBAAD,EAAoBC,oBAApB,IAA4C5F,QAAQ,CAAC,KAAD,CAA1D;AACA,QAAM,CAAC6F,gBAAD,EAAmBC,mBAAnB,IAA0C9F,QAAQ,CAAC,KAAD,CAAxD;AACA,QAAM,CAAC+F,SAAD,EAAYC,YAAZ,IAA4BhG,QAAQ,CAAC,IAAD,CAA1C;AACA,QAAM,CAACiG,YAAD,EAAeC,eAAf,IAAkClG,QAAQ,CAAC,IAAD,CAAhD;AACA,QAAM,CAACmG,aAAD,EAAgBC,gBAAhB,IAAoCpG,QAAQ,CAAC,IAAD,CAAlD;AACA,QAAM,CAACqG,EAAD,EAAKC,KAAL,IAActG,QAAQ,CAAC,IAAD,CAA5B;AAEA,MAAIqE,OAAO,GAAGtE,UAAU,EAAxB;AAEAE,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMsG,UAAU,GAAG3C,aAAa,EAAhC;;AAEA,QAAI;AACF0C,MAAAA,KAAK,CAAC,KAAD,CAAL;AACA7B,MAAAA,UAAU,CAAC,KAAD,CAAV;AACAE,MAAAA,OAAO,CAAC4B,UAAU,CAACpC,QAAZ,CAAP;AACAW,MAAAA,SAAS,CAACyB,UAAU,CAAC3E,KAAZ,CAAT;AACAsE,MAAAA,eAAe,CACb7E,WAAW,CAACkF,UAAU,CAACpC,QAAX,CAAoBpB,kBAApB,CAAuCyD,MAAxC,EAAgD,KAAhD,CADE,CAAf;AAGAJ,MAAAA,gBAAgB,CACd/E,WAAW,CAACkF,UAAU,CAACpC,QAAX,CAAoBpB,kBAApB,CAAuCyD,MAAxC,EAAgD,MAAhD,CADG,CAAhB;AAGD,KAXD,CAWE,OAAO9C,KAAP,EAAc;AACdW,MAAAA,OAAO,CAACC,IAAR,CAAa,QAAb;AACD;AACF,GAjBQ,EAiBN,EAjBM,CAAT;;AAmBA,QAAMmC,mBAAmB,GAAIC,QAAD,IAAc;AACxC1B,IAAAA,gBAAgB,CAAC0B,QAAD,CAAhB;AACD,GAFD;;AAIA,QAAMC,kBAAkB,GAAIpF,IAAD,IAAU;AACnC,QAAIA,IAAI,KAAK,KAAb,EAAoB;AAClBmE,MAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACD,KAFD,MAEO,IAAInE,IAAI,KAAK,MAAb,EAAqB;AAC1BqE,MAAAA,oBAAoB,CAAC,KAAD,CAApB;AACD,KAFM,MAEA,IAAIrE,IAAI,KAAK,YAAb,EAA2B;AAChC,WAAKqF,QAAL,CAAc;AAAEf,QAAAA,gBAAgB,EAAE;AAApB,OAAd;AACAC,MAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD,KAHM,MAGA,IAAIvE,IAAI,KAAK,aAAb,EAA4B;AACjCuE,MAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACD;AACF,GAXD;;AAaA,QAAMe,aAAa,GAAG,MAAM;AAC1B;AACA,wBACE,QAAC,QAAD;AACE,MAAA,EAAE,EAAE;AACFC,QAAAA,QAAQ,EAAE;AADR;AADN;AAAA;AAAA;AAAA;AAAA,YADF;AAOD,GATD;;AAWA,MAAItC,OAAO,IAAI,CAACE,IAAhB,EAAsB;AACpB,wBACE;AAAK,MAAA,SAAS,EAAC,mBAAf;AAAA,6BACE,QAAC,OAAD;AAAS,QAAA,SAAS,EAAC,QAAnB;AAA4B,QAAA,OAAO,EAAC;AAApC;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YADF;AAKD,GAND,MAMO;AACL,wBACE,QAAC,SAAD;AAAW,MAAA,SAAS,EAAC,oBAArB;AAAA,8BACE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,cADF,EAEGe,gBAAgB,gBACf,QAAC,MAAD;AACE,QAAA,kBAAkB,EAAEkB,kBADtB;AAEE,QAAA,SAAS,EAAEjC,IAAI,CAAC3B,kBAAL,CAAwByD,MAFrC;AAGE,QAAA,IAAI,EAAE,KAHR;AAIE,QAAA,aAAa,EAAE5C;AAJjB;AAAA;AAAA;AAAA;AAAA,cADe,GAOb,IATN,EAUG+B,iBAAiB,gBAChB,QAAC,MAAD;AACE,QAAA,kBAAkB,EAAEgB,kBADtB;AAEE,QAAA,SAAS,EAAEjC,IAAI,CAAC3B,kBAAL,CAAwByD,MAFrC;AAGE,QAAA,IAAI,EAAE,MAHR;AAIE,QAAA,aAAa,EAAE5C;AAJjB;AAAA;AAAA;AAAA;AAAA,cADgB,GAOd,IAjBN,EAkBGiC,gBAAgB,gBACf,QAAC,SAAD;AACE,QAAA,KAAK,EAAEd,aADT;AAEE,QAAA,kBAAkB,EAAE4B;AAFtB;AAAA;AAAA;AAAA;AAAA,cADe,GAKb,IAvBN,eAwBE,QAAC,GAAD;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA,+BACE,QAAC,GAAD;AAAA,iCACE;AAAK,YAAA,SAAS,EAAC,MAAf;AAAA,oCACE;AAAG,cAAA,SAAS,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AAAK,cAAA,SAAS,EAAC,YAAf;AAAA,sCACE;AAAI,gBAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AAAG,gBAAA,SAAS,EAAC,WAAb;AAAA,0BAA0BjC,IAAI,CAAC3B,kBAAL,CAAwBjB;AAAlD;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBAFF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cAxBF,eAmCE,QAAC,GAAD;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA,mBACG,GADH,eAEE,QAAC,GAAD;AAAA,iCACE;AAAK,YAAA,SAAS,EAAC,MAAf;AAAA,oCACE;AAAG,cAAA,SAAS,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AAAK,cAAA,SAAS,EAAC,YAAf;AAAA,sCACE;AAAI,gBAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AAAG,gBAAA,SAAS,EAAC,WAAb;AAAA,0BAA0B4C,IAAI,CAAC3B,kBAAL,CAAwBgE;AAAlD;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBAFF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAFF,eAWE,QAAC,GAAD;AAAA,iCACE;AACE,YAAA,SAAS,EAAC,gBADZ;AAEE,YAAA,OAAO,EAAE,MAAMrB,mBAAmB,CAAC,IAAD,CAFpC;AAAA,oCAIE;AAAG,cAAA,SAAS,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,oBAJF,eAKE;AAAK,cAAA,SAAS,EAAC,YAAf;AAAA,sCACE;AAAI,gBAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AAAG,gBAAA,SAAS,EAAC,WAAb;AAAA,0BAA0BO;AAA1B;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBALF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAXF,eAuBE,QAAC,GAAD;AAAA,qBACG,GADH,eAEE;AACE,YAAA,SAAS,EAAC,gBADZ;AAEE,YAAA,OAAO,EAAE,MAAML,oBAAoB,CAAC,IAAD,CAFrC;AAAA,oCAIE;AAAG,cAAA,SAAS,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,oBAJF,eAKE;AAAK,cAAA,SAAS,EAAC,YAAf;AAAA,sCACE;AAAI,gBAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AAAG,gBAAA,SAAS,EAAC,WAAb;AAAA,0BAA0BO;AAA1B;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBALF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAvBF;AAAA;AAAA;AAAA;AAAA;AAAA,cAnCF,eAwEE,QAAC,GAAD;AAAK,QAAA,SAAS,EAAC,UAAf;AAAA,mBACG,GADH,eAEE,QAAC,GAAD;AAAA,qBACG,GADH,eAEE;AAAK,YAAA,SAAS,EAAC,iBAAf;AAAA,oCACE;AAAG,cAAA,SAAS,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AAAI,cAAA,SAAS,EAAC,aAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAFF,eAGE,QAAC,KAAD;AAAO,cAAA,OAAO,MAAd;AAAe,cAAA,KAAK,MAApB;AAAA,sCACE;AAAA,uCACE;AAAI,kBAAA,SAAS,EAAC,wBAAd;AAAA,0CACE;AAAI,oBAAA,SAAS,EAAC,cAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,eAEE;AAAI,oBAAA,SAAS,EAAC,cAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAFF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,sBADF,eAOE;AAAA,0BAAQtB,MAAM,GAAGA,MAAM,CAACmC,GAAP,CAAWrF,WAAX,CAAH,GAA6BK;AAA3C;AAAA;AAAA;AAAA;AAAA,sBAPF;AAAA;AAAA;AAAA;AAAA;AAAA,oBAHF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,eAkBE,QAAC,GAAD;AAAA,qBACG,GADH,eAEE;AAAK,YAAA,SAAS,EAAC,iBAAf;AAAA,oCACE;AAAG,cAAA,SAAS,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AAAI,cAAA,SAAS,EAAC,aAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAFF,eAGE;AAAM,cAAA,SAAS,EAAC,YAAhB;AAAA,yBACG,GADH,eAEE,QAAC,aAAD;AACE,gBAAA,aAAa,EAAE+C,aADjB;AAEE,gBAAA,QAAQ,EAAE0B;AAFZ;AAAA;AAAA;AAAA;AAAA,sBAFF,EAMG1B,aAAa,IAAI,cAAjB,gBACC,QAAC,MAAD;AACE,gBAAA,SAAS,EAAC,WADZ;AAEE,gBAAA,OAAO,EAAE,MAAM;AACbe,kBAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD,iBAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADD,GASG,IAfN;AAAA;AAAA;AAAA;AAAA;AAAA,oBAHF,eAoBE;AACE,cAAA,IAAI,EAAC,QADP;AAEE,cAAA,SAAS,EAAC,gBAFZ;AAGE,cAAA,WAAW,EAAC,UAHd;AAIE,cAAA,QAAQ,EAAGmB,CAAD,IAAO7B,gBAAgB,CAAC6B,CAAC,CAACC,MAAF,CAASC,KAAV;AAJnC;AAAA;AAAA;AAAA;AAAA,oBApBF,eA0BE;AACE,cAAA,IAAI,EAAC,QADP;AAEE,cAAA,SAAS,EAAC,gBAFZ;AAGE,cAAA,WAAW,EAAC,OAHd;AAIE,cAAA,QAAQ,EAAGF,CAAD,IAAO3B,aAAa,CAAC2B,CAAC,CAACC,MAAF,CAASC,KAAV;AAJhC;AAAA;AAAA;AAAA;AAAA,oBA1BF,eAgCE,QAAC,cAAD;AAAgB,cAAA,KAAK,EAAElC,SAAvB;AAAkC,cAAA,OAAO,EAAC,WAA1C;AAAA,sCACE,QAAC,QAAD,CAAU,IAAV;AAAe,gBAAA,OAAO,EAAE,MAAMC,YAAY,CAAC,KAAD,CAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAIE,QAAC,QAAD,CAAU,IAAV;AAAe,gBAAA,OAAO,EAAE,MAAMA,YAAY,CAAC,MAAD,CAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAJF;AAAA;AAAA;AAAA;AAAA;AAAA,oBAhCF,EAwCGG,UAAU,GAAG,CAAb,IACDF,aAAa,GAAG,CADf,IAEDJ,aAAa,KAAK,cAFjB,gBAGC,QAAC,MAAD;AACE,cAAA,IAAI,EAAC,QADP;AAEE,cAAA,OAAO,EAAC,WAFV;AAGE,cAAA,SAAS,EAAC,eAHZ;AAIE,cAAA,OAAO,EAAE,YAAY;AACnBN,gBAAAA,UAAU,CAAC,IAAD,CAAV;AACA,sBAAMxC,WAAW,CACfyC,IAAI,CAAC3B,kBAAL,CAAwBjB,IADT,EAEfiD,aAFe,EAGfI,aAHe,EAIfE,UAJe,EAKfJ,SALe,CAAX,CAMJxB,IANI,CAMC,MAAM;AACXG,kBAAAA,aAAa,GAAGH,IAAhB,CAAsB2D,OAAD,IAAa;AAChCP,oBAAAA,aAAa;AAEbpC,oBAAAA,UAAU,CAAC,KAAD,CAAV;AACAW,oBAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACAE,oBAAAA,aAAa,CAAC,IAAD,CAAb;AACAX,oBAAAA,OAAO,CAACyC,OAAO,CAACjD,QAAT,CAAP;AACAmC,oBAAAA,KAAK,CAACe,IAAI,CAACC,MAAL,GAAcC,QAAd,EAAD,CAAL;AACArB,oBAAAA,eAAe,CACb7E,WAAW,CACT+F,OAAO,CAACjD,QAAR,CAAiBpB,kBAAjB,CAAoCyD,MAD3B,EAET,KAFS,CADE,CAAf;AAMAJ,oBAAAA,gBAAgB,CACd/E,WAAW,CACT+F,OAAO,CAACjD,QAAR,CAAiBpB,kBAAjB,CAAoCyD,MAD3B,EAET,MAFS,CADG,CAAhB;AAMA,2BAAOY,OAAP;AACD,mBArBD;AAsBD,iBA7BK,CAAN;AA8BD,eApCH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAHD,gBA4CC,QAAC,MAAD;AAAQ,cAAA,SAAS,EAAC,eAAlB;AAAkC,cAAA,QAAQ,MAA1C;AAA2C,cAAA,OAAO,EAAC,WAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBApFJ;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAlBF;AAAA;AAAA;AAAA;AAAA;AAAA,cAxEF;AAAA;AAAA;AAAA;AAAA;AAAA,YADF;AA0LD;AACF,CArQM;;GAAM7C,S;UAkBGxE,U;;;KAlBHwE,S","sourcesContent":["import React, { Component, useHistory, useState, useEffect } from 'react';\nimport { Orders } from './Orders';\nimport { UserContext } from '../../context/AppContext';\nimport { AssetInfo } from './AssetInfo';\nimport './Overview.css';\nimport Cookie from 'js-cookie';\nimport Navbar from '../Navbar/Navbar';\nimport '../Navbar/Navbar.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { toast } from 'react-toastify';\nimport { AssetDropdown } from '../UI/AssetDropdown';\nimport { withRouter } from 'react-router-dom';\n\nimport {\n  Container,\n  Row,\n  Col,\n  Table,\n  Spinner,\n  Dropdown,\n  DropdownButton,\n  Button,\n} from 'react-bootstrap';\nimport jwt_decode from 'jwt-decode';\nimport { Redirect } from 'react-router';\n\ntoast.configure();\n\nconst countOrders = (orderList, type) => {\n  let numOrders = 0;\n\n  orderList.forEach((order) => {\n    if (order.type === type) {\n      numOrders++;\n    }\n  });\n  return numOrders;\n};\n\nconst renderAsset = (asset, index) => {\n  return (\n    <tr key={index}>\n      <td className=\"table-body\">{asset.asset.name}</td>\n      <td className=\"table-body\">{asset.quantity}</td>\n    </tr>\n  );\n};\n\nconst renderBlank = () => {\n  return <p>no assets</p>;\n};\n\nconst submitOrder = async (unit, asset, quantity, price, type) => {\n  const orderUrl = 'http://localhost:8080/api/v1/offers/';\n  let token = Cookie.get('token');\n\n  try {\n    const config = {\n      method: 'POST',\n      headers: {\n        Authorization: 'Bearer ' + token,\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        organisationalUnit: unit,\n        asset: asset,\n        quantity: quantity,\n        price: price,\n      }),\n    };\n    const response = await fetch(orderUrl + type.toLowerCase(), config);\n\n    if (response.ok) {\n      //return json\n      toast.success(type + ' order successfully placed ', {\n        position: toast.POSITION.BOTTOM_RIGHT,\n      });\n      return response.json();\n    } else {\n      //\n      return response.json().then((error) => {\n        toast.error(error.message, {\n          position: toast.POSITION.BOTTOM_RIGHT,\n        });\n      });\n    }\n  } catch (error) {}\n};\n\nconst fetchUserData = async () => {\n  let token = Cookie.get('token');\n  let decoded = jwt_decode(token);\n  let username = decoded.sub;\n\n  const userUrl = `http://localhost:8080/api/v1/users/`;\n  const userResponse = await fetch(userUrl + username, {\n    method: 'GET',\n    headers: {\n      Authorization: 'Bearer ' + token,\n      accept: 'application/json',\n      'Content-Type': 'application/json',\n    },\n  });\n  const userData = await userResponse.json();\n\n  let asset;\n\n  try {\n    typeof userData.organisationalUnit.organisationalUnitAssets !== 'undefined'\n      ? (asset = userData.organisationalUnit.organisationalUnitAssets)\n      : (asset = null);\n\n    return {\n      userData: userData,\n      asset: asset,\n    };\n  } catch (error) {\n    history.push('/login');\n  }\n};\n\nexport const Overview2 = () => {\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState(null);\n  const [asset, setAsset] = useState(null);\n  const [assets, setAssets] = useState(null);\n  const [selectedAsset, setSelectedAsset] = useState('Select asset');\n  const [orderType, setOrderType] = useState('BUY');\n  const [orderQuantity, setOrderQuantity] = useState(null);\n  const [orderPrice, setOrderPrice] = useState(null);\n  const [orderResponse, setOrderResponse] = useState(null);\n  const [buyOrdersClicked, setBuyOrdersClicked] = useState(false);\n  const [sellOrdersClicked, setSellOrdersClicked] = useState(false);\n  const [assetInfoClicked, setAssetInfoClicked] = useState(false);\n  const [assetInfo, setAssetInfo] = useState(null);\n  const [numBuyOrders, setNumBuyOrders] = useState(null);\n  const [numSellOrders, setNumSellOrders] = useState(null);\n  const [id, setId] = useState(null);\n\n  let history = useHistory();\n\n  useEffect(() => {\n    const dataObject = fetchUserData();\n\n    try {\n      setId('123');\n      setLoading(false);\n      setUser(dataObject.userData);\n      setAssets(dataObject.asset);\n      setNumBuyOrders(\n        countOrders(dataObject.userData.organisationalUnit.offers, 'BUY')\n      );\n      setNumSellOrders(\n        countOrders(dataObject.userData.organisationalUnit.offers, 'SELL')\n      );\n    } catch (error) {\n      history.push('/login');\n    }\n  }, []);\n\n  const updateSelectedAsset = (newAsset) => {\n    setSelectedAsset(newAsset);\n  };\n\n  const updateClickedState = (type) => {\n    if (type === 'BUY') {\n      setBuyOrdersClicked(false);\n    } else if (type === 'SELL') {\n      setSellOrdersClicked(false);\n    } else if (type === 'ASSET_TRUE') {\n      this.setState({ assetInfoClicked: true });\n      setAssetInfoClicked(true);\n    } else if (type === 'ASSET_FALSE') {\n      setAssetInfoClicked(false);\n    }\n  };\n\n  const handleRefresh = () => {\n    // by calling this method react re-renders the component\n    return (\n      <Redirect\n        to={{\n          pathname: '/login',\n        }}\n      ></Redirect>\n    );\n  };\n\n  if (loading || !user) {\n    return (\n      <div className=\"loading-container\">\n        <Spinner animation=\"border\" variant=\"secondary\" />\n      </div>\n    );\n  } else {\n    return (\n      <Container className=\"overview-container\">\n        <Navbar />\n        {buyOrdersClicked ? (\n          <Orders\n            updateClickedState={updateClickedState}\n            orderList={user.organisationalUnit.offers}\n            type={'BUY'}\n            fetchUserData={fetchUserData}\n          />\n        ) : null}\n        {sellOrdersClicked ? (\n          <Orders\n            updateClickedState={updateClickedState}\n            orderList={user.organisationalUnit.offers}\n            type={'SELL'}\n            fetchUserData={fetchUserData}\n          />\n        ) : null}\n        {assetInfoClicked ? (\n          <AssetInfo\n            asset={selectedAsset}\n            updateClickedState={updateClickedState}\n          />\n        ) : null}\n        <Row className=\"card-row\">\n          <Col>\n            <div className=\"card\">\n              <i className=\"fas fa-users card-icon\"></i>\n              <div className=\"card-inner\">\n                <h2 className=\"card-title\">Organisational Unit</h2>\n                <p className=\"card-text\">{user.organisationalUnit.name}</p>\n              </div>\n            </div>\n          </Col>\n        </Row>\n        <Row className=\"card-row\">\n          {' '}\n          <Col>\n            <div className=\"card\">\n              <i className=\"fas fa-coins card-icon\"></i>\n              <div className=\"card-inner\">\n                <h2 className=\"card-title\">Credits</h2>\n                <p className=\"card-text\">{user.organisationalUnit.credits}</p>\n              </div>\n            </div>\n          </Col>\n          <Col>\n            <div\n              className=\"card clickable\"\n              onClick={() => setBuyOrdersClicked(true)}\n            >\n              <i className=\"fas fa-clipboard-list card-icon green\"></i>\n              <div className=\"card-inner\">\n                <h2 className=\"card-title\">BUY Orders</h2>\n                <p className=\"card-text\">{numBuyOrders}</p>\n              </div>\n            </div>\n          </Col>\n          <Col>\n            {' '}\n            <div\n              className=\"card clickable\"\n              onClick={() => setSellOrdersClicked(true)}\n            >\n              <i className=\"fas fa-clipboard-list card-icon red\"></i>\n              <div className=\"card-inner\">\n                <h2 className=\"card-title\">SELL Orders</h2>\n                <p className=\"card-text\">{numSellOrders}</p>\n              </div>\n            </div>\n          </Col>\n        </Row>\n        <Row className=\"card-row\">\n          {' '}\n          <Col>\n            {' '}\n            <div className=\"card-tall-table\">\n              <i className=\"fas fa-boxes card-icon\"></i>\n              <h3 className=\"card-title \">Assets</h3>\n              <Table striped hover>\n                <thead>\n                  <tr className=\"table-row table-header\">\n                    <th className=\"table-header\">Name</th>\n                    <th className=\"table-header\">Quantity</th>\n                  </tr>\n                </thead>\n                <tbody>{assets ? assets.map(renderAsset) : renderBlank}</tbody>\n              </Table>\n            </div>\n          </Col>\n          <Col>\n            {' '}\n            <div className=\"card-tall-table\">\n              <i className=\"fas fa-store card-icon\"></i>\n              <h3 className=\"card-title \">Trade</h3>\n              <form className=\"form-trade\">\n                {' '}\n                <AssetDropdown\n                  selectedAsset={selectedAsset}\n                  setAsset={updateSelectedAsset}\n                />\n                {selectedAsset != 'Select asset' ? (\n                  <Button\n                    className=\"more-info\"\n                    onClick={() => {\n                      setAssetInfoClicked(true);\n                    }}\n                  >\n                    More Info\n                  </Button>\n                ) : null}\n              </form>\n              <input\n                type=\"number\"\n                className=\"quantity-input\"\n                placeholder=\"Quantity\"\n                onChange={(e) => setOrderQuantity(e.target.value)}\n              ></input>\n              <input\n                type=\"number\"\n                className=\"quantity-input\"\n                placeholder=\"Price\"\n                onChange={(e) => setOrderPrice(e.target.value)}\n              ></input>\n              <DropdownButton title={orderType} variant=\"secondary\">\n                <Dropdown.Item onClick={() => setOrderType('BUY')}>\n                  BUY\n                </Dropdown.Item>\n                <Dropdown.Item onClick={() => setOrderType('SELL')}>\n                  SELL\n                </Dropdown.Item>\n              </DropdownButton>\n              {orderPrice > 0 &&\n              orderQuantity > 0 &&\n              selectedAsset !== 'Select asset' ? (\n                <Button\n                  type=\"button\"\n                  variant=\"secondary\"\n                  className=\"submit-button\"\n                  onClick={async () => {\n                    setLoading(true);\n                    await submitOrder(\n                      user.organisationalUnit.name,\n                      selectedAsset,\n                      orderQuantity,\n                      orderPrice,\n                      orderType\n                    ).then(() => {\n                      fetchUserData().then((newData) => {\n                        handleRefresh();\n\n                        setLoading(false);\n                        setOrderQuantity(null);\n                        setOrderPrice(null);\n                        setUser(newData.userData);\n                        setId(Math.random().toString());\n                        setNumBuyOrders(\n                          countOrders(\n                            newData.userData.organisationalUnit.offers,\n                            'BUY'\n                          )\n                        );\n                        setNumSellOrders(\n                          countOrders(\n                            newData.userData.organisationalUnit.offers,\n                            'SELL'\n                          )\n                        );\n                        return newData;\n                      });\n                    });\n                  }}\n                >\n                  Submit\n                </Button>\n              ) : (\n                <Button className=\"submit-button\" disabled variant=\"secondary\">\n                  Submit\n                </Button>\n              )}\n            </div>\n          </Col>\n        </Row>\n      </Container>\n    );\n  }\n};\n"]},"metadata":{},"sourceType":"module"}